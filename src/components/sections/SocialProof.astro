---
/**
 * SocialProof Component - Pagayo Design System
 * 
 * Display trust indicators: stats, logos, testimonials, badges.
 * 
 * @prop variant - 'stats' | 'logos' | 'testimonials' | 'badges' | 'combined'
 * @prop stats - Array of stat items
 * @prop logos - Array of partner/client logos
 * @prop testimonials - Array of customer quotes
 * @prop badges - Array of trust badges
 * @prop title - Optional section title
 */

import Icon from '../ui/Icon.astro';
import Badge from '../ui/Badge.astro';

interface StatItem {
  value: string;
  label: string;
  icon?: string;
  suffix?: string;
}

interface LogoItem {
  name: string;
  src: string;
  url?: string;
}

interface TestimonialItem {
  quote: string;
  author: string;
  role?: string;
  company?: string;
  avatar?: string;
  rating?: number;
}

interface BadgeItem {
  icon: string;
  text: string;
}

interface Props {
  variant?: 'stats' | 'logos' | 'testimonials' | 'badges' | 'combined';
  stats?: StatItem[];
  logos?: LogoItem[];
  testimonials?: TestimonialItem[];
  badges?: BadgeItem[];
  title?: string;
  subtitle?: string;
  class?: string;
}

const {
  variant = 'stats',
  stats = [],
  logos = [],
  testimonials = [],
  badges = [],
  title,
  subtitle,
  class: className = '',
} = Astro.props;

// Render star rating
const renderStars = (rating: number) => {
  return Array.from({ length: 5 }, (_, i) => i < rating);
};
---

<section class:list={['social-proof-section', `social-proof-${variant}`, className]}>
  {(title || subtitle) && (
    <div class="social-proof-header">
      {title && <h2 class="social-proof-title">{title}</h2>}
      {subtitle && <p class="social-proof-subtitle">{subtitle}</p>}
    </div>
  )}

  {/* Stats Variant */}
  {(variant === 'stats' || variant === 'combined') && stats.length > 0 && (
    <div class="stats-grid">
      {stats.map((stat, index) => (
        <div 
          class="stat-item" 
          style={`animation-delay: ${index * 100}ms;`}
          data-animate
        >
          {stat.icon && (
            <div class="stat-icon">
              <Icon name={stat.icon as any} size={24} />
            </div>
          )}
          <div class="stat-value">
            {stat.value}
            {stat.suffix && <span class="stat-suffix">{stat.suffix}</span>}
          </div>
          <div class="stat-label">{stat.label}</div>
        </div>
      ))}
    </div>
  )}

  {/* Logos Variant */}
  {(variant === 'logos' || variant === 'combined') && logos.length > 0 && (
    <div class="logos-container">
      <div class="logos-track">
        {logos.map((logo) => (
          logo.url ? (
            <a href={logo.url} class="logo-item" target="_blank" rel="noopener">
              <img src={logo.src} alt={logo.name} loading="lazy" />
            </a>
          ) : (
            <div class="logo-item">
              <img src={logo.src} alt={logo.name} loading="lazy" />
            </div>
          )
        ))}
        {/* Duplicate for infinite scroll effect */}
        {logos.map((logo) => (
          <div class="logo-item logo-duplicate" aria-hidden="true">
            <img src={logo.src} alt="" loading="lazy" />
          </div>
        ))}
      </div>
    </div>
  )}

  {/* Testimonials Variant */}
  {(variant === 'testimonials' || variant === 'combined') && testimonials.length > 0 && (
    <div class="testimonials-grid">
      {testimonials.map((testimonial, index) => (
        <div 
          class="testimonial-card" 
          style={`animation-delay: ${index * 150}ms;`}
          data-animate
        >
          {testimonial.rating && (
            <div class="testimonial-rating">
              {renderStars(testimonial.rating).map((filled) => (
                <Icon 
                  name="star" 
                  size={16} 
                  class={filled ? 'star-filled' : 'star-empty'}
                />
              ))}
            </div>
          )}
          <blockquote class="testimonial-quote">
            "{testimonial.quote}"
          </blockquote>
          <div class="testimonial-author">
            {testimonial.avatar && (
              <img 
                src={testimonial.avatar} 
                alt={testimonial.author}
                class="testimonial-avatar"
                loading="lazy"
              />
            )}
            <div class="testimonial-info">
              <div class="testimonial-name">{testimonial.author}</div>
              {(testimonial.role || testimonial.company) && (
                <div class="testimonial-role">
                  {testimonial.role}{testimonial.role && testimonial.company && ' bij '}{testimonial.company}
                </div>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  )}

  {/* Badges Variant */}
  {(variant === 'badges' || variant === 'combined') && badges.length > 0 && (
    <div class="badges-row">
      {badges.map((badge) => (
        <div class="badge-item">
          <Icon name={badge.icon as any} size={20} />
          <span>{badge.text}</span>
        </div>
      ))}
    </div>
  )}
</section>

<style>
  /* Section */
  .social-proof-section {
    padding: var(--space-16) var(--space-4);
  }

  @media (min-width: 768px) {
    .social-proof-section {
      padding: var(--space-20) var(--space-8);
    }
  }

  /* Header */
  .social-proof-header {
    text-align: center;
    max-width: 600px;
    margin: 0 auto var(--space-12);
  }

  .social-proof-title {
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--color-text);
    margin-bottom: var(--space-3);
  }

  .social-proof-subtitle {
    font-size: var(--text-base);
    color: var(--color-text-muted);
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-8);
    max-width: var(--container-lg);
    margin: 0 auto;
  }

  .stat-item {
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s ease forwards;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .stat-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    color: var(--color-accent);
    margin-bottom: var(--space-3);
  }

  .stat-value {
    font-size: var(--text-4xl);
    font-weight: 700;
    color: var(--color-text);
    line-height: 1;
    margin-bottom: var(--space-2);
  }

  .stat-suffix {
    font-size: var(--text-2xl);
    color: var(--color-accent);
  }

  .stat-label {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Logos */
  .logos-container {
    overflow: hidden;
    padding: var(--space-8) 0;
    mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
  }

  .logos-track {
    display: flex;
    gap: var(--space-12);
    animation: scroll 30s linear infinite;
  }

  @keyframes scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  .logos-track:hover {
    animation-play-state: paused;
  }

  .logo-item {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 40px;
    opacity: 0.5;
    filter: grayscale(100%);
    transition: all var(--transition-base);
  }

  .logo-item:hover {
    opacity: 1;
    filter: grayscale(0%);
  }

  .logo-item img {
    max-height: 100%;
    width: auto;
  }

  /* Testimonials */
  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-6);
    max-width: var(--container-xl);
    margin: 0 auto;
  }

  .testimonial-card {
    padding: var(--space-6);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s ease forwards;
  }

  .testimonial-rating {
    display: flex;
    gap: var(--space-1);
    margin-bottom: var(--space-4);
  }

  .star-filled {
    color: #f59e0b;
  }

  .star-empty {
    color: var(--color-border);
  }

  .testimonial-quote {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: 1.7;
    margin: 0 0 var(--space-6);
    font-style: italic;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .testimonial-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    object-fit: cover;
  }

  .testimonial-name {
    font-weight: 600;
    color: var(--color-text);
    font-size: var(--text-sm);
  }

  .testimonial-role {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  /* Badges Row */
  .badges-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-6);
    max-width: var(--container-lg);
    margin: 0 auto;
  }

  .badge-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .badge-item :global(svg) {
    color: var(--color-success);
  }

  /* Combined Variant Spacing */
  .social-proof-combined .stats-grid {
    margin-bottom: var(--space-16);
  }

  .social-proof-combined .logos-container {
    margin-bottom: var(--space-16);
  }

  .social-proof-combined .testimonials-grid {
    margin-bottom: var(--space-12);
  }

  /* Dark Mode */
  [data-theme="dark"] .testimonial-card {
    background: rgba(22, 27, 34, 0.8);
  }

  [data-theme="dark"] .logo-item {
    filter: grayscale(100%) brightness(0.8) invert(1);
  }

  [data-theme="dark"] .logo-item:hover {
    filter: grayscale(0%) brightness(1) invert(0);
  }
</style>
