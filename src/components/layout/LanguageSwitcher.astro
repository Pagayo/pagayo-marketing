---
import { languages, switchLanguage, type Language } from '../../utils/i18n';

interface Props {
  currentLang: Language;
  currentPath: string;
}

const { currentLang, currentPath } = Astro.props;
---

<div class="lang-switcher">
  <button
    id="language-button"
    type="button"
    class="lang-button"
    aria-haspopup="true"
    aria-expanded="false"
  >
    <span class="lang-flag">{languages[currentLang].flag}</span>
    <span class="lang-label">{languages[currentLang].label}</span>
    <svg class="lang-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <div
    id="language-menu"
    class="lang-menu hidden"
    role="menu"
    aria-orientation="vertical"
  >
    {
      Object.values(languages).map((lang) => (
        <a
          href={switchLanguage(currentPath, lang.code)}
          class={`lang-item ${currentLang === lang.code ? 'active' : ''}`}
          role="menuitem"
        >
          <span class="lang-flag">{lang.flag}</span>
          <span>{lang.label}</span>
          {currentLang === lang.code && (
            <svg class="lang-check" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          )}
        </a>
      ))
    }
  </div>
</div>

<style>
  .lang-switcher {
    position: relative;
  }
  
  .lang-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    font-size: 14px;
    font-weight: 600;
    color: #475569;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    transition: all 0.15s ease;
    cursor: pointer;
  }
  
  .lang-button:hover {
    border-color: #cbd5e1;
    background: #f8fafc;
  }
  
  .lang-flag {
    font-size: 18px;
    line-height: 1;
  }
  
  .lang-label {
    display: none;
  }
  
  @media (min-width: 640px) {
    .lang-label {
      display: inline;
    }
  }
  
  .lang-icon {
    width: 14px;
    height: 14px;
    transition: transform 0.2s ease;
  }
  
  .lang-button[aria-expanded="true"] .lang-icon {
    transform: rotate(180deg);
  }
  
  .lang-menu {
    position: absolute;
    right: 0;
    top: calc(100% + 8px);
    min-width: 200px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
    overflow: hidden;
    z-index: 50;
  }
  
  .lang-menu.hidden {
    display: none;
  }
  
  .lang-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    font-size: 15px;
    font-weight: 500;
    color: #334155;
    text-decoration: none;
    transition: all 0.15s ease;
    border-bottom: 1px solid #f1f5f9;
  }
  
  .lang-item:last-child {
    border-bottom: none;
  }
  
  .lang-item:hover {
    background: #f8fafc;
    color: #0f172a;
  }
  
  .lang-item.active {
    background: #f0f9ff;
    color: #0369a1;
    font-weight: 600;
  }
  
  .lang-check {
    width: 16px;
    height: 16px;
    margin-left: auto;
    color: #0369a1;
  }
</style>

<script>
  const button = document.getElementById('language-button');
  const menu = document.getElementById('language-menu');

  if (button && menu) {
    button.addEventListener('click', () => {
      const isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden');
      button.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
    });

    // Close on click outside
    document.addEventListener('click', (e) => {
      if (!button.contains(e.target as Node) && !menu.contains(e.target as Node)) {
        menu.classList.add('hidden');
        button.setAttribute('aria-expanded', 'false');
      }
    });
  }
</script>
