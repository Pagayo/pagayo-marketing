---
/**
 * FeaturesGrid Component - Pagayo Design System
 */

import Card from '../ui/Card.astro';
import Icon from '../ui/Icon.astro';
import Badge from '../ui/Badge.astro';

interface FeatureItem {
  icon: string;
  title: string;
  description: string;
  link?: string;
  badge?: string;
}

interface Props {
  features: FeatureItem[];
  title?: string;
  subtitle?: string;
  columns?: 2 | 3 | 4;
  variant?: 'cards' | 'icons' | 'minimal';
  class?: string;
}

const {
  features,
  title,
  subtitle,
  columns = 3,
  variant = 'cards',
  class: className = '',
} = Astro.props;

// Map emoji icons to Icon component names
const getIconName = (icon: string): string => {
  const iconMap: Record<string, string> = {
    'ðŸ’³': 'credit-card',
    'ðŸª™': 'coins',
    'ðŸ§®': 'shopping-cart',
    'ðŸ“¡': 'bar-chart',
    'ðŸ§¾': 'repeat',
    'ðŸ“¦': 'package',
    'ðŸª': 'store',
    'ðŸ“…': 'calendar',
    'ðŸ”’': 'lock',
    'âš¡': 'zap',
    'ðŸŒ': 'globe',
    'ðŸ‘¥': 'users',
  };
  return iconMap[icon] || icon;
};

const isEmoji = (icon: string): boolean => {
  return /\p{Emoji}/u.test(icon) && icon.length <= 2;
};
---

<section class:list={['features-section', className]}>
  {(title || subtitle) && (
    <div class="features-header">
      {title && <h2 class="features-title">{title}</h2>}
      {subtitle && <p class="features-subtitle">{subtitle}</p>}
    </div>
  )}
  
  <div class:list={['features-grid', `features-grid-${columns}`, `features-${variant}`]}>
    {features.map((feature, index) => (
      <div 
        class="feature-item" 
        style={`animation-delay: ${index * 100}ms;`}
      >
        {variant === 'cards' ? (
          <Card variant="outlined" hoverable={!!feature.link} href={feature.link} padding="lg">
            <div class="feature-icon-wrapper">
              {isEmoji(feature.icon) ? (
                <span class="feature-emoji">{feature.icon}</span>
              ) : (
                <Icon name={getIconName(feature.icon) as any} size={28} />
              )}
            </div>
            {feature.badge && (
              <Badge color="purple" size="sm" class="feature-badge">
                {feature.badge}
              </Badge>
            )}
            <h3 class="feature-title">{feature.title}</h3>
            <p class="feature-description">{feature.description}</p>
            {feature.link && (
              <span class="feature-link">
                Meer info <Icon name="arrow-right" size={16} />
              </span>
            )}
          </Card>
        ) : variant === 'icons' ? (
          <a href={feature.link} class="feature-icon-card">
            <div class="feature-icon-large">
              {isEmoji(feature.icon) ? (
                <span class="feature-emoji-large">{feature.icon}</span>
              ) : (
                <Icon name={getIconName(feature.icon) as any} size={40} />
              )}
            </div>
            <h3 class="feature-title">{feature.title}</h3>
            <p class="feature-description">{feature.description}</p>
          </a>
        ) : (
          <div class="feature-minimal">
            <div class="feature-minimal-icon">
              {isEmoji(feature.icon) ? (
                <span>{feature.icon}</span>
              ) : (
                <Icon name={getIconName(feature.icon) as any} size={20} />
              )}
            </div>
            <div class="feature-minimal-content">
              <h3 class="feature-title">{feature.title}</h3>
              <p class="feature-description">{feature.description}</p>
            </div>
          </div>
        )}
      </div>
    ))}
  </div>
</section>

<style>
  /* Section Styles - GitHub Dark */
  .features-section {
    padding: var(--space-20) var(--space-4);
    background: #0d1117;
    position: relative;
    z-index: 5;
  }

  @media (min-width: 768px) {
    .features-section {
      padding: var(--space-24) var(--space-8);
    }
  }

  /* Header */
  .features-header {
    text-align: center;
    max-width: 700px;
    margin: 0 auto var(--space-12);
  }

  .features-title {
    font-size: var(--text-4xl);
    font-weight: 700;
    color: #c9d1d9;
    margin-bottom: var(--space-4);
  }

  .features-subtitle {
    font-size: var(--text-lg);
    color: #8b949e;
    line-height: 1.6;
  }

  /* Grid Layout */
  .features-grid {
    display: grid;
    gap: var(--space-6);
    max-width: var(--container-xl);
    margin: 0 auto;
  }

  .features-grid-2 {
    grid-template-columns: repeat(2, 1fr);
  }

  .features-grid-3 {
    grid-template-columns: repeat(3, 1fr);
  }

  .features-grid-4 {
    grid-template-columns: repeat(4, 1fr);
  }

  @media (max-width: 1024px) {
    .features-grid-3,
    .features-grid-4 {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .features-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Feature Item Animation - GitHub Dark */
  .feature-item {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s ease forwards;
  }

  .feature-item :global(.card) {
    background: #161b22;
    border: 1px solid #30363d;
    transition: all 0.3s ease;
  }

  .feature-item:hover :global(.card) {
    transform: translateY(-4px);
    border-color: #00ff88;
    box-shadow: 0 8px 24px rgba(0, 255, 136, 0.15);
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Card Variant - GitHub Dark */
  .features-cards .feature-icon-wrapper {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-4);
    color: #00ff88;
    transition: transform 0.3s ease, background 0.3s ease;
  }

  .feature-item:hover .feature-icon-wrapper {
    background: linear-gradient(135deg, #00ff88, #00e077);
    color: #0d1117;
    transform: scale(1.1);
    border-color: transparent;
  }

  .feature-emoji {
    font-size: 1.75rem;
  }

  .feature-badge {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
  }

  .feature-title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: #c9d1d9;
    margin-bottom: var(--space-2);
  }

  .feature-description {
    font-size: var(--text-base);
    color: #8b949e;
    line-height: 1.6;
  }

  .feature-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    margin-top: var(--space-4);
    font-size: var(--text-sm);
    font-weight: 500;
    color: #00ff88;
  }

  /* Icon Variant - GitHub Dark */
  .feature-icon-card {
    display: block;
    text-align: center;
    padding: var(--space-6);
    text-decoration: none;
    color: inherit;
    border-radius: var(--radius-lg);
    transition: background var(--transition-base);
  }

  .feature-icon-card:hover {
    background: #161b22;
  }

  .feature-icon-large {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #00ff88, #00e077);
    border-radius: var(--radius-xl);
    margin: 0 auto var(--space-4);
    color: #0d1117;
  }

  .feature-emoji-large {
    font-size: 2.5rem;
  }

  /* Minimal Variant - GitHub Dark */
  .feature-minimal {
    display: flex;
    gap: var(--space-4);
    align-items: flex-start;
  }

  .feature-minimal-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: var(--radius-md);
    flex-shrink: 0;
    color: #00ff88;
  }

  .feature-minimal-content {
    flex: 1;
  }
</style>
